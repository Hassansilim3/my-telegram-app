<!DOCTYPE html>
<html>
<head>
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù…Ø¹ Firebase</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        /* Ù†ÙØ³ Ø§Ù„Ø¥Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚ */
        :root { --bg-color: #fff; --text-color: #000; }
        body.dark { --bg-color: #1a1a1a; --text-color: #fff; }
        body { font-family: Arial; padding: 20px; }
        .card { background: rgba(0,0,0,0.1); padding: 20px; border-radius: 15px; margin: 15px 0; }
        button { background: #2AABEE; color: white; padding: 10px 20px; border: none; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</h1>
        
        <div class="card">
            <h3>Ø±ØµÙŠØ¯Ùƒ: <span id="points">0</span> Ù†Ù‚Ø·Ø©</h3>
            <button onclick="addPoints(50)">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·</button>
        </div>

        <div class="card">
            <h2>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h2>
            <div id="referralLink" class="referral-box"></div>
            <button onclick="copyLink()">Ù†Ø³Ø®</button>
            <button onclick="shareLink()">Ù…Ø´Ø§Ø±ÙƒØ©</button>
        </div>
    </div>

    <script>
        // â”â”â”â”â”â”â”â” ØªÙ‡ÙŠØ¦Ø© Firebase â”â”â”â”â”â”â”â”
        const firebaseConfig = {
  apiKey: "AIzaSyA_g4eMwWa0lcHDdU-PZ-uFp5VuKFiQtnM",
  authDomain: "rsuz-4c69f.firebaseapp.com",
  projectId: "rsuz-4c69f",
  storageBucket: "rsuz-4c69f.firebasestorage.app",
  messagingSenderId: "663553404737",
  appId: "1:663553404737:web:a43ffbf1e2379cfe6d7bc0",
  measurementId: "G-2H87Q5WPS1"
};
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // â”â”â”â”â”â”â”â” ØªÙ‡ÙŠØ¦Ø© Telegram Web App â”â”â”â”â”â”â”â”
        const webApp = Telegram.WebApp;
        const user = webApp.initDataUnsafe.user;
        let referralLink = "";

        // â”â”â”â”â”â”â”â” Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â”â”â”â”â”â”â”â”
        async function initUser() {
            const userRef = db.collection('users').doc(String(user.id));
            const doc = await userRef.get();
            
            if (!doc.exists) {
                const urlParams = new URLSearchParams(window.location.search);
                const referrer = urlParams.get('ref');
                
                await userRef.set({
                    points: 100,
                    referrals: [],
                    referrer: referrer || null,
                    created_at: firebase.firestore.FieldValue.serverTimestamp()
                });

                if (referrer) {
                    await db.collection('users').doc(referrer).update({
                        points: firebase.firestore.FieldValue.increment(50),
                        referrals: firebase.firestore.FieldValue.arrayUnion(user.id)
                    });
                }
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            userRef.onSnapshot((doc) => {
                document.getElementById('points').textContent = doc.data().points;
            });
            
            referralLink = `https://t.me/${webApp.initDataUnsafe.bot.username}?start=ref_${user.id}`;
            document.getElementById('referralLink').textContent = referralLink;
        }

        // â”â”â”â”â”â”â”â” Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· â”â”â”â”â”â”â”â”
        async function addPoints(amount) {
            await db.collection('users').doc(String(user.id)).update({
                points: firebase.firestore.FieldValue.increment(amount)
            });
            webApp.showAlert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${amount} Ù†Ù‚Ø·Ø©! ğŸ‰`);
        }

        // â”â”â”â”â”â”â”â” Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· â”â”â”â”â”â”â”â”
        function copyLink() {
            navigator.clipboard.writeText(referralLink);
            webApp.showAlert('ØªÙ… Ø§Ù„Ù†Ø³Ø®! âœ…');
        }

        // â”â”â”â”â”â”â”â” Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø· â”â”â”â”â”â”â”â”
        function shareLink() {
            webApp.openLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}`);
        }

        // â”â”â”â”â”â”â”â” Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ â”â”â”â”â”â”â”â”
        webApp.ready();
        webApp.expand();
        document.body.className = webApp.colorScheme === 'dark' ? 'dark' : '';
        initUser();
    </script>
</body>
  </html>
