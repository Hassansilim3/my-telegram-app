<!DOCTYPE html>
<html>
<head>
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --primary: #2AABEE;
        }
        body.dark {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
        }
        body {
            font-family: Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            margin: 0;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .card {
            background: rgba(0, 0, 0, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 16px;
            transition: opacity 0.3s;
        }
        button:active {
            opacity: 0.8;
        }
        .referral-box {
            background: rgba(42, 171, 238, 0.1);
            padding: 15px;
            border-radius: 10px;
            word-break: break-all;
            margin: 15px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª (Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ©)</h1>
        
        <div class="card">
            <h3>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="points">0</span> Ù†Ù‚Ø·Ø©</h3>
            <button onclick="addPoints(50)">+50 Ù†Ù‚Ø·Ø© ğŸ</button>
        </div>

        <div class="card">
            <h2>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</h2>
            <div class="referral-box" id="referralLink"></div>
            <div>
                <button onclick="copyLink()">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ“‹</button>
                <button onclick="shareLink()">Ù…Ø´Ø§Ø±ÙƒØ© â¤</button>
            </div>
        </div>
    </div>

    <script>
        // â”â”â”â”â”â”â”â” Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© â”â”â”â”â”â”â”â”
        const webApp = Telegram.WebApp;
        let userPoints = 0;
        let referralLink = "";

        // â”â”â”â”â”â”â”â” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† â”â”â”â”â”â”â”â”
        function initUser() {
            try {
                const user = webApp.initDataUnsafe.user;
                if (!user) throw new Error("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…");
                
                // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
                userPoints = parseInt(localStorage.getItem(`user_${user.id}_points`)) || 100;
                document.getElementById('points').textContent = userPoints;

                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
                referralLink = `https://t.me/${webApp.initDataUnsafe.bot.username}?start=ref_${user.id}`;
                document.getElementById('referralLink').textContent = referralLink;

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
                const urlParams = new URLSearchParams(window.location.search);
                const referrer = urlParams.get('ref');
                if (referrer) {
                    webApp.showAlert(`ØªÙ…Øª Ø¥Ø­Ø§Ù„ØªÙƒ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${referrer}`);
                }

            } catch (error) {
                webApp.showAlert(`Ø®Ø·Ø£: ${error.message}`);
            }
        }

        // â”â”â”â”â”â”â”â” Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø· â”â”â”â”â”â”â”â”
        function addPoints(amount) {
            const user = webApp.initDataUnsafe.user;
            userPoints += amount;
            localStorage.setItem(`user_${user.id}_points`, userPoints);
            document.getElementById('points').textContent = userPoints;
            webApp.showAlert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${amount} Ù†Ù‚Ø·Ø©! ğŸ‰`);
        }

        // â”â”â”â”â”â”â”â” Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· â”â”â”â”â”â”â”â”
        function copyLink() {
            try {
                navigator.clipboard.writeText(referralLink).then(() => {
                    webApp.showAlert("ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­! âœ…");
                }).catch(() => {
                    manualCopy();
                });
            } catch (error) {
                manualCopy();
            }
        }

        function manualCopy() {
            const input = document.createElement('input');
            input.value = referralLink;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            webApp.showAlert("Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§: " + referralLink);
        }

        // â”â”â”â”â”â”â”â” Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø· â”â”â”â”â”â”â”â”
        function shareLink() {
            webApp.openLink(
                `https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=Ø§Ù†Ø¶Ù…+Ù„Ù„Ø­ØµÙˆÙ„+Ø¹Ù„Ù‰+Ù…ÙƒØ§ÙØ¢Øª+Ø±Ø§Ø¦Ø¹Ø©!ğŸ‰`
            );
        }

        // â”â”â”â”â”â”â”â” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ â”â”â”â”â”â”â”â”
        webApp.ready();
        webApp.expand(); // ÙØªØ­ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        document.body.className = webApp.colorScheme === 'dark' ? 'dark' : '';
        initUser();
    </script>
</body>
</html>
